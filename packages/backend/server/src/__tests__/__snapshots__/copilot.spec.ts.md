# Snapshot report for `src/__tests__/copilot.spec.ts`

The actual snapshot is saved in `copilot.spec.ts.snap`.

Generated by [AVA](https://avajs.dev).

## should be able to manage chat session

> should generate the final message

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: 'hello',
        role: 'user',
      },
    ]

> should generate different message with another params

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: 'hello',
        role: 'user',
      },
    ]

## should be able to fork chat session

> should generate the final message

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: 'hello',
        params: {},
        role: 'user',
      },
      {
        content: 'world',
        params: {},
        role: 'assistant',
      },
    ]

> should generate the final message

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: 'hello',
        params: {},
        role: 'user',
      },
      {
        content: 'world',
        params: {},
        role: 'assistant',
      },
    ]

> should generate the final message

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: 'hello',
        params: {},
        role: 'user',
      },
      {
        content: 'world',
        params: {},
        role: 'assistant',
      },
      {
        content: 'aaa',
        params: {},
        role: 'user',
      },
      {
        content: 'bbb',
        params: {},
        role: 'assistant',
      },
    ]

> should generate the final message

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: 'hello',
        params: {},
        role: 'user',
      },
      {
        content: 'world',
        params: {},
        role: 'assistant',
      },
      {
        content: 'aaa',
        params: {},
        role: 'user',
      },
      {
        content: 'bbb',
        params: {},
        role: 'assistant',
      },
    ]

## should revert message correctly

> should have three messages before revert

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: '1',
        role: 'user',
      },
      {
        content: '2',
        role: 'assistant',
      },
      {
        content: '3',
        role: 'user',
      },
      {
        content: '4',
        role: 'assistant',
      },
    ]

> should remove assistant message after revert

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: '1',
        role: 'user',
      },
      {
        content: '2',
        role: 'assistant',
      },
      {
        content: '3',
        role: 'user',
      },
    ]

> should remove assistant message after revert

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: '1',
        role: 'user',
      },
      {
        content: '2',
        role: 'assistant',
      },
    ]

> should have three messages before revert

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: '1',
        role: 'user',
      },
      {
        content: '2',
        role: 'assistant',
      },
      {
        content: '3',
        role: 'user',
      },
      {
        content: '4',
        role: 'assistant',
      },
    ]

> should remove assistant message after revert

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: '1',
        role: 'user',
      },
      {
        content: '2',
        role: 'assistant',
      },
      {
        content: '3',
        role: 'user',
      },
    ]

> should remove assistant message after revert

    [
      {
        content: 'hello world',
        params: {
          word: 'world',
        },
        role: 'system',
      },
      {
        content: '1',
        role: 'user',
      },
      {
        content: '2',
        role: 'assistant',
      },
    ]

## should be able to run image executor

> should generate image stream

    [
      {
        params: {
          key: [
            'https://example.com/test-image.jpg',
            'tag1, tag2, tag3, tag4, tag5, ',
          ],
        },
        type: 2,
      },
    ]

> should render the prompt with params array

    [
      {
        modelId: 'test-image',
      },
      [
        {
          content: 'tag1, tag2, tag3, tag4, tag5, ',
          params: {
            tags: [
              'tag4',
              'tag5',
            ],
          },
          role: 'user',
        },
      ],
      {},
    ]

## should handle generateSessionTitle correctly under various conditions

> should generate title when conditions are met

    {
      chatWithPromptCalled: undefined,
      exists: true,
      title: 'What is Machine Learning?',
    }

> should not generate title when session already has title

    {
      chatWithPromptCalled: false,
      exists: true,
      title: 'Existing Title',
    }

> should not generate title when no user messages exist

    {
      chatWithPromptCalled: false,
      exists: true,
      title: null,
    }

> should not generate title when no assistant messages exist

    {
      chatWithPromptCalled: false,
      exists: true,
      title: null,
    }

> should use correct prompt for title generation

    {
      content: `[user]: Explain quantum computing brieflyâŠ
      [assistant]: Quantum computing uses quantum mechanics principles.`,
      promptName: 'Summary as title',
    }

## should handle copilot cron jobs correctly

> daily job scheduling calls

    [
      {
        args: [
          'copilot.session.cleanupEmptySessions',
          {},
          {
            jobId: 'daily-copilot-cleanup-empty-sessions',
          },
        ],
      },
      {
        args: [
          'copilot.session.generateMissingTitles',
          {},
          {
            jobId: 'daily-copilot-generate-missing-titles',
          },
        ],
      },
      {
        args: [
          'copilot.workspace.cleanupTrashedDocEmbeddings',
          {},
          {
            jobId: 'daily-copilot-cleanup-trashed-doc-embeddings',
          },
        ],
      },
    ]

> cleanup empty sessions calls

    [
      {
        args: [
          'Date',
        ],
      },
    ]

> title generation calls

    {
      jobCalls: [
        {
          args: [
            'copilot.session.generateTitle',
            {
              sessionId: 'session1',
            },
          ],
        },
        {
          args: [
            'copilot.session.generateTitle',
            {
              sessionId: 'session2',
            },
          ],
        },
      ],
      modelCalls: [
        {
          args: [],
        },
      ],
    }
