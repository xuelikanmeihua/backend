# Snapshot report for `src/__tests__/models/copilot-session.spec.ts`

The actual snapshot is saved in `copilot-session.spec.ts.snap`.

Generated by [AVA](https://avajs.dev).

## should list and filter session type

> workspace sessions should include workspace and pinned sessions

    [
      {
        docId: null,
        pinned: true,
      },
      {
        docId: null,
        pinned: false,
      },
    ]

> doc sessions should only include sessions with matching docId

    [
      {
        docId: 'doc-id-1',
        pinned: false,
        promptName: 'action-prompt',
      },
      {
        docId: 'doc-id-1',
        pinned: false,
        promptName: 'test-prompt',
      },
    ]

> session type identification results

    [
      {
        session: {
          docId: null,
          pinned: false,
        },
        type: 'workspace',
      },
      {
        session: {
          docId: undefined,
          pinned: false,
        },
        type: 'workspace',
      },
      {
        session: {
          docId: null,
          pinned: true,
        },
        type: 'pinned',
      },
      {
        session: {
          docId: 'doc-id-1',
          pinned: false,
        },
        type: 'doc',
      },
    ]

## should validate session prompt compatibility

> session prompt validation results

    [
      {
        promptType: 'non-action',
        result: 'success',
        sessionType: 'workspace',
        shouldThrow: false,
      },
      {
        promptType: 'action',
        result: 'CopilotPromptInvalid',
        sessionType: 'workspace',
        shouldThrow: true,
      },
      {
        promptType: 'non-action',
        result: 'success',
        sessionType: 'pinned',
        shouldThrow: false,
      },
      {
        promptType: 'action',
        result: 'CopilotPromptInvalid',
        sessionType: 'pinned',
        shouldThrow: true,
      },
      {
        promptType: 'non-action',
        result: 'success',
        sessionType: 'doc',
        shouldThrow: false,
      },
      {
        promptType: 'action',
        result: 'success',
        sessionType: 'doc',
        shouldThrow: false,
      },
    ]

## should pin and unpin sessions

> session states after creating second pinned session

    [
      {
        docId: null,
        id: 'first-session-id',
        pinned: false,
      },
      {
        docId: null,
        id: 'second-session-id',
        pinned: true,
      },
    ]

> should return false when no sessions to unpin

    false

> all sessions should be unpinned after unpin operation

    [
      {
        id: 'first-session-id',
        pinned: false,
      },
      {
        id: 'second-session-id',
        pinned: false,
      },
      {
        id: 'third-session-id',
        pinned: false,
      },
    ]

## should handle session updates and type conversions

> session update validation results

    [
      {
        result: 'rejected',
        sessionType: 'action',
        update: {
          docId: 'new-doc',
        },
      },
      {
        result: 'rejected',
        sessionType: 'action',
        update: {
          pinned: true,
        },
      },
      {
        result: 'rejected',
        sessionType: 'action',
        update: {
          promptName: 'test-prompt',
        },
      },
      {
        result: 'success',
        sessionType: 'forked',
        update: {
          pinned: true,
        },
      },
      {
        result: 'success',
        sessionType: 'forked',
        update: {
          promptName: 'test-prompt',
        },
      },
      {
        result: 'rejected',
        sessionType: 'forked',
        update: {
          docId: 'new-doc',
        },
      },
      {
        result: 'success',
        sessionType: 'regular',
        update: {
          promptName: 'test-prompt',
        },
      },
      {
        result: 'rejected',
        sessionType: 'regular',
        update: {
          promptName: 'action-prompt',
        },
      },
      {
        result: 'rejected',
        sessionType: 'regular',
        update: {
          promptName: 'non-existent-prompt',
        },
      },
    ]

> pinning behavior - should unpin existing when pinning new

    {
      onlyOneSessionPinned: true,
      pinnedSessions: 1,
      totalSessions: 2,
      unpinnedSessions: 1,
    }

> session type conversion steps

    [
      {
        sessionState: {
          hasDocId: true,
          pinned: false,
        },
        step: 'workspace_to_doc',
        type: 'doc',
      },
      {
        sessionState: {
          hasDocId: false,
          pinned: false,
        },
        step: 'doc_to_workspace',
        type: 'workspace',
      },
      {
        sessionState: {
          hasDocId: false,
          pinned: true,
        },
        step: 'workspace_to_pinned',
        type: 'pinned',
      },
    ]

## should handle session queries, ordering, and filtering

> comprehensive session query results

    {
      all_workspace_sessions: {
        count: 7,
        sessionTypes: [
          {
            hasMessages: false,
            isAction: false,
            isFork: true,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: true,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'pinned',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'workspace',
          },
        ],
      },
      doc_sessions_with_messages: {
        count: 5,
        sessionTypes: [
          {
            hasMessages: false,
            isAction: false,
            isFork: true,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: true,
            isAction: false,
            isFork: false,
            messageCount: 1,
            type: 'doc',
          },
          {
            hasMessages: true,
            isAction: false,
            isFork: false,
            messageCount: 1,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: true,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: true,
            isAction: false,
            isFork: false,
            messageCount: 1,
            type: 'doc',
          },
        ],
      },
      latest_valid_session: {
        count: 1,
        sessionTypes: [
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
        ],
      },
      non_action_sessions: {
        count: 4,
        sessionTypes: [
          {
            hasMessages: false,
            isAction: false,
            isFork: true,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
        ],
      },
      non_fork_sessions: {
        count: 4,
        sessionTypes: [
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: true,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
        ],
      },
      recent_top3_sessions: {
        count: 3,
        sessionTypes: [
          {
            hasMessages: false,
            isAction: false,
            isFork: true,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'doc',
          },
        ],
      },
      workspace_sessions_with_messages: {
        count: 2,
        sessionTypes: [
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'pinned',
          },
          {
            hasMessages: false,
            isAction: false,
            isFork: false,
            messageCount: 0,
            type: 'workspace',
          },
        ],
      },
    }

> session type identification results

    [
      {
        session: {
          docId: null,
          pinned: false,
        },
        type: 'workspace',
      },
      {
        session: {
          docId: undefined,
          pinned: false,
        },
        type: 'workspace',
      },
      {
        session: {
          docId: null,
          pinned: true,
        },
        type: 'pinned',
      },
      {
        session: {
          docId: 'test-doc-id',
          pinned: false,
        },
        type: 'doc',
      },
    ]

## should handle fork and session attachment operations

> fork operation results

    {
      existingPinnedSessionUnpinned: true,
      forkResults: [
        {
          actualState: {
            hasDocId: false,
            hasParent: true,
            isDocIdCorrect: true,
            pinned: false,
          },
          description: 'workspace fork',
          success: true,
        },
        {
          actualState: {
            hasDocId: true,
            hasParent: true,
            isDocIdCorrect: true,
            pinned: false,
          },
          description: 'doc fork',
          success: true,
        },
        {
          actualState: {
            hasDocId: false,
            hasParent: true,
            isDocIdCorrect: true,
            pinned: true,
          },
          description: 'pinned fork',
          success: true,
        },
      ],
    }

> attach and detach operation results

    {
      attachPhase: {
        bothSessionsPresent: true,
        docSessionCount: 2,
      },
      detachPhase: {
        originalDocSessionRemains: true,
        workspaceSessionExists: true,
      },
    }

## should cleanup empty sessions correctly

> cleanup empty sessions results

    {
      cleanupResult: {
        cleaned: 0,
        removed: 0,
      },
      remainingSessions: [
        {
          deleted: false,
          pinned: false,
          type: 'zeroCost',
        },
        {
          deleted: false,
          pinned: false,
          type: 'zeroCost',
        },
        {
          deleted: false,
          pinned: false,
          type: 'noMessages',
        },
        {
          deleted: false,
          pinned: false,
          type: 'noMessages',
        },
        {
          deleted: false,
          pinned: false,
          type: 'recent',
        },
        {
          deleted: false,
          pinned: false,
          type: 'withMessages',
        },
      ],
    }

## should get sessions for title generation correctly

> sessions for title generation results

    {
      onlyValidSessionsReturned: true,
      sessions: [
        {
          assistantMessageCount: 1,
          isValid: true,
        },
        {
          assistantMessageCount: 2,
          isValid: true,
        },
      ],
      total: 2,
    }
