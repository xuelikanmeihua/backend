# Snapshot report for `src/plugins/indexer/__tests__/service.spec.ts`

The actual snapshot is saved in `service.spec.ts.snap`.

Generated by [AVA](https://avajs.dev).

## should write block with array content work

> Snapshot 1

    [
      {
        fields: {
          content: [
            'hello world',
          ],
        },
      },
    ]

## should parse all query work

> Snapshot 1

    {
      _source: [
        'workspace_id',
        'doc_id',
      ],
      fields: [
        'flavour',
        'doc_id',
        'ref_doc_id',
      ],
      query: {
        match_all: {},
      },
      sort: [
        '_score',
        {
          updated_at: 'desc',
        },
        'id',
      ],
    }

## should parse exists query work

> Snapshot 1

    {
      _source: [
        'workspace_id',
        'doc_id',
      ],
      fields: [
        'flavour',
        'doc_id',
        'ref_doc_id',
      ],
      query: {
        exists: {
          field: 'ref_doc_id',
        },
      },
      sort: [
        '_score',
        {
          updated_at: 'desc',
        },
        'id',
      ],
    }

## should parse boost query work

> Snapshot 1

    {
      _source: [
        'workspace_id',
        'doc_id',
      ],
      fields: [
        'flavour',
        'doc_id',
        'ref_doc_id',
      ],
      query: {
        term: {
          flavour: {
            boost: 1.5,
            value: 'affine:page',
          },
        },
      },
      sort: [
        '_score',
        {
          updated_at: 'desc',
        },
        'id',
      ],
    }

## should parse match query work

> Snapshot 1

    {
      _source: [
        'workspace_id',
        'doc_id',
      ],
      fields: [
        'flavour',
        'doc_id',
        'ref_doc_id',
        'parent_flavour',
        'parent_block_id',
        'additional',
        'markdown_preview',
        'created_by_user_id',
        'updated_by_user_id',
        'created_at',
        'updated_at',
      ],
      query: {
        term: {
          flavour: {
            value: 'affine:page',
          },
        },
      },
      sort: [
        '_score',
        {
          updated_at: 'desc',
        },
        'id',
      ],
    }

## should parse boolean query work

> Snapshot 1

    {
      _source: [
        'workspace_id',
        'doc_id',
      ],
      fields: [
        'flavour',
        'doc_id',
        'ref_doc_id',
        'parent_flavour',
        'parent_block_id',
        'additional',
        'markdown_preview',
        'created_by_user_id',
        'updated_by_user_id',
        'created_at',
        'updated_at',
      ],
      query: {
        bool: {
          must: [
            {
              term: {
                workspace_id: {
                  value: 'workspaceId1',
                },
              },
            },
            {
              match: {
                content: {
                  query: 'hello',
                },
              },
            },
            {
              bool: {
                should: [
                  {
                    match: {
                      content: {
                        query: 'hello',
                      },
                    },
                  },
                  {
                    term: {
                      flavour: {
                        boost: 1.5,
                        value: 'affine:page',
                      },
                    },
                  },
                ],
              },
            },
          ],
        },
      },
      sort: [
        '_score',
        {
          updated_at: 'desc',
        },
        'id',
      ],
    }

## should parse search input highlight work

> Snapshot 1

    {
      _source: [
        'workspace_id',
        'doc_id',
      ],
      fields: [
        'flavour',
        'doc_id',
        'ref_doc_id',
      ],
      highlight: {
        fields: {
          content: {
            post_tags: [
              '</b>',
            ],
            pre_tags: [
              '<b>',
            ],
          },
        },
      },
      query: {
        match_all: {},
      },
      sort: [
        '_score',
        {
          updated_at: 'desc',
        },
        'id',
      ],
    }

## should parse aggregate input highlight work

> Snapshot 1

    {
      _source: [
        'workspace_id',
        'doc_id',
      ],
      aggs: {
        result: {
          aggs: {
            max_score: {
              max: {
                script: {
                  source: '_score',
                },
              },
            },
            result: {
              top_hits: {
                _source: [
                  'workspace_id',
                  'doc_id',
                ],
                fields: [
                  'flavour',
                  'doc_id',
                  'ref_doc_id',
                ],
                highlight: {
                  fields: {
                    content: {
                      post_tags: [
                        '</b>',
                      ],
                      pre_tags: [
                        '<b>',
                      ],
                    },
                  },
                },
              },
            },
          },
          terms: {
            field: 'flavour',
            order: {
              max_score: 'desc',
            },
            size: undefined,
          },
        },
      },
      query: {
        match_all: {},
      },
      sort: [
        '_score',
        {
          updated_at: 'desc',
        },
        'id',
      ],
    }

## should search work

> Snapshot 1

    [
      {
        fields: {
          summary: [
            'this is a test',
          ],
          title: [
            'hello world',
          ],
        },
        highlights: {
          title: [
            '<b>hello</b> world',
          ],
        },
      },
    ]

> Snapshot 2

    [
      {
        fields: {
          summary: [
            '这是测试',
          ],
          title: [
            '你好世界',
          ],
        },
        highlights: {
          title: [
            '<b>你好</b> 世界',
          ],
        },
      },
    ]

## should search with exists query work

> Snapshot 1

    [
      {
        fields: {
          blockId: [
            'blockId1',
          ],
          parentBlockId: [
            'blockId2',
          ],
        },
      },
    ]

## should search a doc summary work

> Snapshot 1

    [
      {
        fields: {
          summary: [
            'hello world, this is a summary',
          ],
        },
      },
    ]

## should aggregate with bool must_not query work

> Snapshot 1

    [
      {
        count: 2,
        hits: [
          {
            fields: {
              additional: [
                '{"foo": "bar3"}',
              ],
              markdownPreview: [
                'hello world, this is a title',
              ],
              parentBlockId: [
                'parentBlockId1',
              ],
              parentFlavour: [
                'affine:database',
              ],
            },
          },
          {
            fields: {
              additional: [
                '{"foo": "bar3"}',
              ],
              markdownPreview: [
                'hello world, this is a title',
              ],
              parentBlockId: [
                'parentBlockId2',
              ],
              parentFlavour: [
                'affine:database',
              ],
            },
          },
        ],
      },
      {
        count: 1,
        hits: [
          {
            fields: {
              additional: [
                '{"foo": "bar3"}',
              ],
              markdownPreview: [
                'hello world, this is a title',
              ],
              parentBlockId: [
                'parentBlockId3',
              ],
              parentFlavour: [
                'affine:database',
              ],
            },
          },
        ],
      },
    ]

## should index doc work

> Snapshot 1

    {
      summary: [
        'AFFiNE is an open source all in one workspace, an operating system for all the building blocks of your team wiki, knowledge management and digital assets and a better alternative to Notion and Miro. You own your data, with no compromisesLocal-first & Real-time collaborativeWe love the idea proposed by Ink & Switch in the famous article about you owning your data, despite the cloud. Furthermore, AFFiNE is the first all-in-one workspace that keeps your data ownership with no compromises on real-time collaboration and editing experience.AFFiNE is a local-first application upon CRDTs with real-time collaboration support. Your data is always stored locally while multiple nodes remain synced in real-time.Blocks that assemble your next docs, tasks kanban or whiteboardThere is a large overlap of their atomic "building blocks" between these apps. They are neither open source nor have a plugin system like VS Code for contributors to customize. We want to have something that contains all the features we love and goes one step further. ',
      ],
      title: [
        'Write, Draw, Plan all at Once.',
      ],
    }

> Snapshot 2

    [
      {
        blockId: [
          'VMx9lHw3TR',
        ],
        content: [
          'For developers or installations guides, please go to AFFiNE Doc',
        ],
        flavour: [
          'affine:paragraph',
        ],
      },
      {
        blockId: [
          '9-K49otbCv',
        ],
        content: [
          'For developer or installation guides, please go to AFFiNE Development',
        ],
        flavour: [
          'affine:paragraph',
        ],
      },
    ]

## should search blob names from doc snapshot work

> Snapshot 1

    Map {
      'ldZMrM4PDlsNG4Q4YvCsz623h6TKu4qI9_FpTqIypfw=' => 'test file name here.txt',
    }

## should search blob names work

> Snapshot 1

    [
      [
        'blob1',
        'blob1 name.txt',
      ],
      [
        'blob2',
        'blob2 name.md',
      ],
      [
        'blob3',
        'blob3 name.docx',
      ],
    ]

## should search docs by keyword work

> Snapshot 1

    [
      {
        blockId: 'block1',
        createdAt: Date 2025-06-20 00:00:00 UTC {},
        highlight: '<b>hello</b> world',
        title: 'hello world',
        updatedAt: Date 2025-06-20 00:00:00 UTC {},
      },
      {
        blockId: 'block2',
        createdAt: Date 2025-06-20 00:00:01 UTC {},
        highlight: '<b>hello</b> world 2',
        title: 'hello world 2',
        updatedAt: Date 2025-06-20 00:00:01 UTC {},
      },
      {
        blockId: 'block3',
        createdAt: Date 2025-06-20 00:00:02 UTC {},
        highlight: '<b>hello</b> world 3',
        title: 'hello world 3',
        updatedAt: Date 2025-06-20 00:00:02 UTC {},
      },
      {
        blockId: 'block4',
        createdAt: Date 2025-06-20 00:00:03 UTC {},
        highlight: '<b>hello</b> world 4',
        title: '',
        updatedAt: Date 2025-06-20 00:00:03 UTC {},
      },
    ]
